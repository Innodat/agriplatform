# Project Operating Rules â€” Digital Twin Platform
(React + Vite + Supabase MCP + ShadCN UI + Fullâ€‘stack Discipline)

## Workflow Modes
- Always start in **PLAN** mode:
  - Read memory_bank/* before output.
  - Read docs/tech-spec.md for architectural patterns and conventions.
  - Query Supabase MCP for **live schema** before proposing any data models, UI components, or API endpoints.
  - For frontend (UI): Use the â€œFrontend Planning Promptâ€ below.
  - For backend (API/services): Use the â€œBackend Planning Promptâ€ below.
  - Include a section recommending `.clinerules` / memory_bank updates for future quality/speed.
  - WAIT for explicit `APPROVE LAYOUT: yes` before writing **any code**.

- **ACT** mode:
  - Implement **only** what was approved in PLAN.
  - Use the corresponding â€œActing Promptâ€ below.
  - Chunk changes; stop after scaffolding for confirmation before deeper integrations.

## Model Routing Defaults
- Planning (free, UIâ€‘strong): `Geminiâ€¯2.5â€¯Pro`
- Planning (deep/fullâ€‘stack vision): `GPTâ€‘5 Thinking`
- Acting (frontend or backend): `Claudeâ€¯Sonnetâ€¯4` for clean, maintainable code
- Budget: `DeepSeekâ€¯R1` (plan) / `DeepSeekâ€¯V3` (act)

## Supabase MCP
- MUST be queried before any data model or API changes.
- Zod schemas must exactly match MCP schema (types, enums, nullability).
- Backend: also generate request/response Zod schemas per endpoint.

## UI Patterns
- Stack: React + Vite + TypeScript + Tailwind + **ShadCN UI** (installed components)
- Nav: `<AppShell>` (Topbar + Sidebar); Departments in sidebar; modules as subroutes.
- Accessibility: labels, ariaâ€‘attributes, keyboard nav, color contrast checks.
- Responsiveness: mobileâ€‘first, Tailwind grid/flex.

## Backend Patterns
- Service layer per business capability; thin controllers/handlers.
- Routes reflect clear REST or RPC patterns.
- Input validation with Zod; outputs also validated.
- Consistent error payloads: `{ error: string, code?: number, details?: any }`

## Confirmation Gates
- Gate 1: Layout/API diagram approved (`APPROVE LAYOUT: yes`)
- Gate 2: Scaffolding approved before wiring DB or business logic.
- Gate 3: Final review before merge.

## Conventions
- Files: kebab-case; Components & Services: PascalCase; Types: infer from Zod.
- Commits: conventional commits (`feat:`, `fix:`, `refactor:`, `docs:`, `chore:`)

---

### ğŸ“œ Frontend Planning Prompt (embedded)

> Model: `Gemini 2.5 Pro` (free) or `GPTâ€‘5 Thinking` (deep)
> 
> â€œYou are an expert React + Vite engineer, fullâ€‘stack architect, and promptâ€‘engineering strategist, operating inside Cline with Supabase MCP enabled.
> 
> **Project context**: Digital twin platform for a farm. Current focus: Finance â†’ Receipt Capturing.
> 
> **Tasks**:
> 1. Query Supabase MCP for `receipts` and role/auth tables.
> 2. Generate exact Zod schemas; infer types.
> 3. Review page.tsx; list components (shared vs feature-local); define props.
> 4. Design scalable platform layout (AppShell + Departments + module tabs).
> 5. **Show ASCII layout diagram + route map first** â€” no code.
> 6. Propose file tree for React+Vite + ShadCN UI.
> 7. Output: (A) ASCII layout + routes (B) Components list (C) Zod schemas (D) File tree (E) Refactor steps (F) Acceptance checklist (G) Rule/memory updates.
> 
> WAIT for â€˜APPROVE LAYOUT: yesâ€™ before coding.â€

---

### ğŸ“œ Backend Planning Prompt (embedded)

> Model: `Gemini 2.5 Pro` or `GPTâ€‘5 Thinking`
> 
> â€œYou are an expert TypeScript backend and API architect, operating inside Cline with Supabase MCP enabled.
> 
> **Project context**: Digital twin platform. Current focus: Finance â†’ Receipt Capturing APIs.
> 
> **Persistent Context for Frontend:**
> - Monorepo layout:
>   - /packages/frontend â†’ React + Vite + Tailwind + ShadCN UI
>   - /supabase â†’ CLI config, migrations, seeds, MCP access
>   - /memory_bank and .clinerules at repo root with system patterns and dualâ€‘schema sync rules
> - Current module: Finance â†’ Receipt Capturing dashboard
> - Backend: Supabase direct from frontend (no custom backend yet)
> - Validation: Zod schemas from live Supabase MCP schema
> - UI: Roleâ€‘gated tabs (Admin vs Employee) â€” Views: Overview, Today, Admin
> - Current goals: Refine layout & styling to match original `page.tsx` look and feel; reâ€‘implement Today and Admin; add Supabaseâ€‘auth login screen
> **Tasks**:
> 1. Query Supabase MCP for `receipts` and role/auth schemas.
> 2. Generate Zod schemas for requests/responses matching live schema.
> 3. Design service/API architecture for this module (REST or RPC).
> 4. Produce API diagram + route map first â€” no code yet.
> 5. Propose folder structure for services, routes, lib.
> 6. Output: (A) API diagram/map (B) Services/routes list (C) Zod schemas (D) File tree (E) Build steps (F) Acceptance checklist (G) Rule/memory updates.
> 7. Produce updates to the docs/tech-spec.md file to keep the architecture, design decisions, and patterns up to date. The purpose is for future planning tasks to keep to adhere to it.  
> 
> WAIT for â€˜APPROVE LAYOUT: yesâ€™ before coding.â€

---

### ğŸ“œ Acting Prompt (Frontend & Backend, embedded)

> Model: `Claude Sonnet 4.5` (UI clean code) or `GPTâ€‘5 Codex` (unified flow)
> 
> â€œUsing the approved plan:
> - Scaffold as planned (FE: layouts/components; BE: services/routes).
> - Integrate Zod validation from plan.
> - Wire Supabase MCP queries/mutations aligned to live schema.
> - Keep Tailwind + ShadCN UI (frontend).
> - Ensure accessibility (FE) and strict TS (both).
> - Stop after scaffolding for confirmation before wiring complex logic.â€
> - **After scaffolding or refactor work is complete**:
>   - Open `memory_bank/progress.md`
>   - Mark completed checklist items with âœ”
>   - Add a dated "Postâ€‘ACT Update â€“ YYYYâ€‘MMâ€‘DD" section noting:
>     - What was delivered
>     - Any deviations from the original plan
>     - Remaining TODOsâ€
